{
  "$comment": "Taint/approval constraints example - elevation + declassification",
  "policy": {
    "format": "fzpf",
    "schema_version": "0.1",
    "policy_id": "taint-approval-example",
    "default_deny": true
  },
  "defaults": {
    "taint": {
      "require_elevation_min_safety": "risky",
      "require_approval_min_safety": "dangerous"
    }
  },
  "zones": [
    {
      "id": "z:private",
      "name": "Private Zone",
      "integrity_level": 80,
      "confidentiality_level": 90
    },
    {
      "id": "z:work",
      "name": "Work Zone",
      "integrity_level": 60,
      "confidentiality_level": 70,
      "parent": "z:private"
    },
    {
      "id": "z:public",
      "name": "Public Zone",
      "integrity_level": 20,
      "confidentiality_level": 10,
      "parent": "z:work"
    }
  ],
  "zone_policies": [
    {
      "zone_id": "z:private",
      "principal_allow": ["p:owner:*", "p:private:*"],
      "connector_allow": ["fcp.*"],
      "capability_deny": ["system.exec"]
    },
    {
      "zone_id": "z:work",
      "principal_allow": ["p:owner:*", "p:work:*"],
      "connector_allow": ["fcp.slack", "fcp.gmail"]
    },
    {
      "zone_id": "z:public",
      "principal_allow": ["*"],
      "connector_allow": ["fcp.web"],
      "capability_allow": ["web.search", "web.fetch"]
    }
  ],
  "flows": [
    {
      "name": "public-to-private-blocked",
      "from": "z:public",
      "to": "z:private",
      "kind": "ingress",
      "allow": false,
      "audit": true
    },
    {
      "name": "public-to-work-elevation",
      "from": "z:public",
      "to": "z:work",
      "kind": "ingress",
      "allow": true,
      "requires_elevation": true,
      "audit": true
    },
    {
      "name": "private-to-public-declassify",
      "from": "z:private",
      "to": "z:public",
      "kind": "egress",
      "allow": true,
      "requires_declassification": true,
      "transform": "redact_secrets",
      "audit": true
    },
    {
      "name": "work-to-public-declassify",
      "from": "z:work",
      "to": "z:public",
      "kind": "egress",
      "allow": true,
      "requires_declassification": true,
      "audit": true
    }
  ],
  "taint_rules": [
    {
      "name": "block-malicious",
      "taint_flags": ["malicious_detected"],
      "action": {
        "type": "deny",
        "reason": "Malicious content detected"
      }
    },
    {
      "name": "sanitize-unverified-links",
      "taint_flags": ["unverified_link"],
      "min_safety": "risky",
      "action": {
        "type": "sanitize",
        "sanitizer": "fcp.url-scanner",
        "reason": "Unverified links require scanning"
      }
    },
    {
      "name": "elevate-public-to-private",
      "taint_flags": ["public_input"],
      "when_integrity_insufficient": true,
      "origin_zone_patterns": ["z:public"],
      "target_zone_patterns": ["z:private", "z:work"],
      "action": {
        "type": "require_elevation",
        "ttl_seconds": 300,
        "mode": "interactive",
        "reason": "Public input driving private zone operation"
      }
    },
    {
      "name": "approve-dangerous-ops",
      "min_safety": "dangerous",
      "taint_flags": ["public_input", "user_generated"],
      "action": {
        "type": "require_approval",
        "ttl_seconds": 60,
        "mode": "interactive",
        "reason": "Dangerous operation from untrusted input"
      }
    },
    {
      "name": "require-pii-approval",
      "taint_flags": ["pii_present"],
      "target_zone_patterns": ["z:public", "z:community"],
      "action": {
        "type": "require_approval",
        "ttl_seconds": 300,
        "mode": "interactive",
        "reason": "PII data flowing to lower trust zone"
      }
    }
  ],
  "approval_constraints": [
    {
      "name": "elevation-for-email-send",
      "scope_type": "elevation",
      "zone_id": "z:work",
      "connector_pattern": "fcp.gmail",
      "method_pattern": "email.send",
      "target_integrity": 60,
      "max_ttl_seconds": 300,
      "require_request_binding": true
    },
    {
      "name": "declassify-to-public",
      "scope_type": "declassification",
      "from_zone": "z:private",
      "to_zone": "z:public",
      "target_confidentiality": 10,
      "max_ttl_seconds": 60,
      "require_request_binding": true,
      "require_input_hash": true
    },
    {
      "name": "execution-slack-send",
      "scope_type": "execution",
      "zone_id": "z:work",
      "connector_pattern": "fcp.slack",
      "method_pattern": "message.send*",
      "max_ttl_seconds": 300,
      "require_request_binding": true,
      "input_constraints": [
        {
          "pointer": "/channel",
          "op": "prefix",
          "value": "#work-"
        },
        {
          "pointer": "/mentions",
          "op": "not_in",
          "value": ["@channel", "@here"]
        }
      ]
    },
    {
      "name": "execution-file-write",
      "scope_type": "execution",
      "zone_id": "z:private",
      "connector_pattern": "fcp.files",
      "method_pattern": "file.write",
      "max_ttl_seconds": 60,
      "require_request_binding": true,
      "require_input_hash": true,
      "input_constraints": [
        {
          "pointer": "/path",
          "op": "prefix",
          "value": "/home/user/documents/"
        },
        {
          "pointer": "/path",
          "op": "suffix",
          "value": ".txt"
        }
      ]
    }
  ]
}
